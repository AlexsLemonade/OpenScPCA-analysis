# This is a workflow to build and optionally push all module Docker images
#
# This workflow will run only on manual triggers

name: Build all Docker images
on:
  workflow_dispatch:
    inputs:
      push-ecr:
        description: "Push to AWS ECR"
        type: boolean
        required: false

jobs:
  build-docker-modules:
    name: Build Docker Images
    strategy:
      fail-fast: false
      matrix:
        # add all modules with active docker images here
        module:
          - hello-python
          - simulate-sce
    uses: ./.github/workflows/build-push-docker-module.yml
    with:
      module: ${{ matrix.module }}
      push-ecr: ${{ inputs.push-ecr }}

  check-jobs:
    name: Check Job Status
    if: always()
    needs:
      - build-docker-modules
    runs-on: ubuntu-latest
    steps:
      - name: Check for failures or cancelled jobs
        if: contains(needs.*.result, 'failure') || contains(needs.*.result, 'cancelled')
        run: echo "Job failed" && exit 1
